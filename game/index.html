<!DOCTYPE html>
<html>
	<head>
		<title>specter inspectors</title>
		<script node> getAsset("meta") </script>node>
		<script node> getAsset("google fonts") </script>node>
		<link rel="shortcut icon" type="image/png" href="logo.png"/>
		<link rel="stylesheet" type="text/css" href="stylesheet.css"/>
		<script type="text/javascript" src="script.js"></script>
		<script>window.game = <script node>JSON.stringify(request.game)</script>node></script>
		<script node>var player = request.game.players[request.session.id] || null</script>node>
	</head>
	<body>
		<div id="error" class="hidden"></div>
		<div id="container">
			<div id="notes">
				<div class="spacer"></div>
				<div class="content">
					<div class="header">notes</div>
					<textarea id="notes-input" placeholder="add your notes here" rows="5" value=""><script node>player ? player.notes : ""</script>node></textarea>
				</div>
				<button class="slideContainer" value="left">&#8594;</button>
				<button class="slideContainer" value="right">&#8592;<br><br>&#8592;<br><br>&#8592;</button>
			</div>
			<div id="story">
				<div class="content">
					<div class="header">story</div>
					<div id="events-list">
						<script node>
							var events = Object.keys(request.game.events).filter(function(e) {
								return request.game.events[e].viewers.indexOf(request.session.id) !== -1
							}).sort(function(x, y) {
								return request.game.events[x].created > request.game.events[y].created
							})
							var eventList = ""

							for (var e in events) {
								var event = request.game.events[events[e]]
								try {
									// get answer
										var answer = event.answer || ""
										if (answer !== "") {
											var disabled = " disabled "
										}
										else {
											var disabled = ""
										}

									// inputs
										var inputBlock = ""

										if (event.input == "text") {
											inputBlock = '<input class="event-input" type="text" placeholder="your response" value="' + answer + '"' + disabled + '/>\
												<button class="event-button" value="submit-text"' + disabled + '>&#8682;</button>'
										}
										else if (event.input == "select") {
											var options = []
											for (var o in event.options) {
												var value = event.options[o]
												
												// replace ids with names
													var p = request.game.players[value] || false
													if (p) {
														var name = p.name
													}
													else {
														var name = event.options[o]
													}

												// get selected
													if (answer === value) {
														var selected = " selected "
													}
													else {
														var selected = ""
													}

												options.push('<option value="' + value + '"' + selected + '>' + name + '</option>')
											}

											// structure
												inputBlock = '<select class="event-select"' + disabled + '>\
													<optgroup label="select..."></optgroup>\
													' + options.join("") + '\
												</select>\
												<button class="event-button" value="submit-select"' + disabled + '>&#8682;</button>'
										}
										else if (event.input == "okay") {
											inputBlock = '<button class="event-button" value="okay"' + disabled + '>' + event.options + '</button>'
										}
										else if (event.input == "buttons") {
											inputBlock = '<button class="event-button" value=false' + disabled + '>' + event.options[0] + '</button>\
													<button class="event-button" value=true' + disabled + '>' + event.options[1] + '</button>'
										}
										else if (event.input == "link") {
											inputBlock = '<a class="event-link" href="' + event.options[0] + '">' + event.options[1] + '</a>'
										}

									// info & structure
										eventList = eventList + '<div class="event ' + event.type + '" id="' + event.id + '">\
											<div class="event-type">' + event.type + '</div>\
											<div class="event-time">' + (new Date(event.created).toLocaleString().split(",")[1]) + '</div>\
											<div class="event-text">' + event.text + '</div>\
											' + inputBlock + '\
										</div>'
								}
								catch (error) {
									main.logError("unable to display event: " + JSON.stringify(event))
								}
							}

							eventList || ""
						</script>node>
					</div>
				</div>
			</div>
			<div id="chats" <script node>if (["killer", "ghost", "telepath"].indexOf(player.status.role) == -1) { 'style="display: none"' } </script>node>>
				<button class="slideContainer" value="left">&#8594;<br><br>&#8594;<br><br>&#8594;</button>
				<button class="slideContainer" value="right">&#8592;</button>
				<div class="content">
					<div class="header"><script node>
						if (["killer", "ghost", "telepath"].indexOf(player.status.role) == -1) {
							player.status.role + " "
						}
					</script>node>chat</div>
					<div id="chats-list">
						<script node>
							if (["killer", "ghost", "telepath"].indexOf(player.status.role) !== -1) {
								var chats = request.game.chats[player.status.role].sort(function (x, y) {
									return x.created > y.created
								})
								var chatList = ""

								for (var c in chats) {
									try {
										chatList = chatList + '<div class="chat">\
											<div class="chat-info">\
												<div class="chat-author">' + request.game.players[chats[c].author].name + '</div>\
												<div class="chat-time">' + (new Date(chats[c].created).toLocaleString().split(",")[1]) + '</div>\
											</div>\
											<div class="chat-text">' + chats[c].text + '</div>\
										</div>'
									}
									catch (error) {
										main.logError("unable to display chat: " + JSON.stringify(chats[c]))
									}
								}
							}

							chatList || ""
						</script>node>
					</div>
					<input id="chats-input" type="text" placeholder="type your message here"/><button id="chats-button">&#8682;</button>
				</div>
				<div class="spacer"></div>
			</div>
		</div>
	</body>
</html>