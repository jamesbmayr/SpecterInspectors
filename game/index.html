<!DOCTYPE html>
<html>
	<head>
		<title>specter inspectors</title>
		<script node> getAsset("meta") </script>node>
		<script node> getAsset("google fonts") </script>node>
		<link rel="shortcut icon" type="image/png" href="logo.png"/>
		<link rel="stylesheet" type="text/css" href="stylesheet.css"/>
		<script type="text/javascript" src="script.js"></script>
		<script node>
			var player = request.game.players[request.session.id] || null
			if (request.game.state.end) { "<script>window.clearLoop = true</script>" }
		</script>node>
	</head>
	<body>
		<div id="graveyard"></div>
		<div id="error" class="hidden"></div>
		<div id="container">
			<div id="notes" class="<script node>if (!request.game.state.start) { 'invisible' }</script>node>">
				<div class="spacer"></div>
				<div class="content">
					<div class="header">Notes</div>
					<textarea id="notes-input" placeholder="add your notes here" rows="5" value=""><script node>player ? player.notes : ""</script>node></textarea>
				</div>
				<button value="left" class="slideContainer">&#8594;</button>
				<button value="right" class="slideContainer" >&#8592;<br><br>&#8592;<br><br>&#8592;</button>
			</div>
			<div id="story">
				<div class="content">
					<div class="header">Specter Inspectors</div>
					<div id="events-list">
						<script node>
							var playerIDs = Object.keys(request.game.players)
							var events = Object.keys(request.game.events).filter(function(e) {
								return request.game.events[e].viewers.indexOf(request.session.id) !== -1
							})

							events = events.sort(function(x, y) {
								return Number(request.game.events[x].created) > Number(request.game.events[y].created)
							}).sort(function(x, y) {
								return Number(request.game.events[x].created) > Number(request.game.events[y].created)
							}).sort(function(x, y) {
								return Number(request.game.events[x].created) > Number(request.game.events[y].created)
							})
							
							var eventList = ""

							for (var e in events) {
								var event = request.game.events[events[e]]

								try {
									// get answer
										var answer = event.answer || ""
										if (answer !== "") {
											var disabled = " disabled "
										}
										else {
											var disabled = ""
										}

									// inputs
										var inputBlock = ""

										if (event.input == "text") {
											inputBlock = '<input class="event-input" type="text" placeholder="your response" value="' + answer + '"' + disabled + '/>\
												<button class="event-button" value="submit-text"' + disabled + '>&#10515;</button>'
										}
										else if (event.input == "select") {
											var options = []
											for (var o = 0; o < event.options.length; o++) {
												// get selected
													if (answer == event.options[o]) {
														var selected = " selected "
													}
													else {
														var selected = ""
													}

												options.push('<option value="' + event.options[o] + '"' + selected + '>' + (event.names ? event.names[o] : event.options[o]) + '</option>')
											}

											// structure
												inputBlock = '<select class="event-select"' + disabled + '>\
													<optgroup label="select..."></optgroup>\
													' + options.join("") + '\
												</select>\
												<button class="event-button" value="submit-select"' + disabled + '>&#10515;</button>'
										}
										else if (event.input == "okay") {
											inputBlock = '<button class="event-button" value="okay"' + disabled + '>' + event.options + '</button>'
										}
										else if (event.input == "buttons") {
											inputBlock = '<button class="event-button" value=0' + disabled + '>' + event.options[0] + '</button>\
													<button class="event-button" value=1' + disabled + '>' + event.options[1] + '</button>'
										}
										else if (event.input == "link") {
											inputBlock = '<a class="event-link" href="' + event.options[0] + '">' + event.options[1] + '</a>'
										}

									// info & structure
										eventList = eventList + '<div class="event ' + event.type + '" id="' + event.id + '" day=' + event.day + ' night=' + event.night + '>\
											<div class="event-type">' + event.type + '</div>\
											<div class="event-time">' + (new Date(event.created).toLocaleString().split(",")[1]) + '</div>\
											<div class="event-text">' + event.text + '</div>\
											' + inputBlock + '\
										</div>'
								}
								catch (error) {
									logError("unable to display event: " + JSON.stringify(event) + "\n" + error)
								}
							}

							eventList || ""
						</script>node>
					</div>
				</div>
			</div>
			<div id="chats" class="<script node>if (player.status.alive && player.status.good && (player.status.role !== 'telepath')) { 'hidden' }</script>node>">
				<button class="slideContainer" value="left">&#8594;<br><br>&#8594;<br><br>&#8594;</button>
				<button class="slideContainer" value="right">&#8592;</button>
				<div class="content">
					<div class="header"><script node>
						if (!player.status.alive) {
							"Ghost "
						}
						else if (!player.status.good) {
							"Killer "
						}
						else if (player.status.role == "telepath") {
							"Telepath "
						}
					</script>node>Chat</div>
					<div id="chats-list">
						<script node>
							if (!player.status.alive) {
								var chats = request.game.chats["ghost"].sort(function (x, y) {
									return x.created > y.created
								})
							}
							else if (!player.status.good) {
								var chats = request.game.chats["killer"].sort(function (x, y) {
									return x.created > y.created
								})
							}
							else if (player.status.role == "telepath") {
								var chats = request.game.chats["telepath"].sort(function (x, y) {
									return x.created > y.created
								})
							}
							else {
								var chats = false
							}

							if (chats) {
								var chatList = ""

								for (var c in chats) {
									try {
										chatList = chatList + '<div class="chat" id="' + chats[c].id + '">\
											<div class="chat-info">\
												<div class="chat-author">' + chats[c].name + '</div>\
												<div class="chat-time">' + (new Date(chats[c].created).toLocaleString().split(",")[1]) + '</div>\
											</div>\
											<div class="chat-text">' + chats[c].text + '</div>\
										</div>'
									}
									catch (error) {
										main.logError("unable to display chat: " + JSON.stringify(chats[c]))
									}
								}

								chatList || ""
							}
						</script>node>
					</div>
					<input id="chats-input" type="text" placeholder="type your message here"/><button id="chats-button">&#10515;</button>
				</div>
				<div class="spacer"></div>
			</div>
		</div>
	</body>
</html>
